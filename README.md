[![Build Status](https://dev.azure.com/arnavion/k8s-openapi-codegen/_apis/build/status/Arnavion.k8s-openapi-codegen?branchName=master)](https://dev.azure.com/arnavion/k8s-openapi-codegen/_build/latest?definitionId=1)

This binary generates Rust types for the resources and API in the Kubernetes
OpenAPI spec.


# Generated Kubernetes Client for Rust

This is an unofficial Rust Kubernetes API client generated from Kubernetes's
OpenAPI spec

## Motivation

While there is [official client
generator](https://github.com/kubernetes-client/gen) it is not perfect and this
crate aims to address the issues currently present in official generator.


##### Better package structure

Kubernetes uses `x-kubernetes-*` annotations to annotate the APIs in the spec
and this crate uses them to make the API as inherent methods of the
corresponding struct.

See [Pod::list_core_v1_namespaced_pod](https://github.com/Arnavion/k8s-openapi-codegen/blob/15777b259ac16cc4287da3ede50f62d3c4508be9/k8s-openapi/src/v1_13/api/core/v1/pod.rs#L1770).
The swagger-generated specs don't do this, so they put all API in giant
top-level traits.


##### Optional method parameters

Implemented via [default-able
structs](https://github.com/Arnavion/k8s-openapi-codegen/commit/bbbc770a9be50159decffc098bf2d88fa933ef1c).
No more `None, None, None...` ugliness.


##### IO agnostic

Sync/Async? - Your choice. API generated by this crate uses the [sans-io approach](https://sans-io.readthedocs.io/) popularized by Python.
[Example](https://github.com/Arnavion/k8s-openapi-codegen/blob/15777b259ac16cc4287da3ede50f62d3c4508be9/k8s-openapi/src/lib.rs#L140-L142).


##### Support for older kubernetes API versions

Old versions of Kubernetes API Spec do not work with [official client generator](https://github.com/kubernetes-client/gen). See
[here](https://github.com/Arnavion/k8s-openapi-codegen/blob/15777b259ac16cc4287da3ede50f62d3c4508be9/src/supported_version.rs#L43)
for the breakdown of fixes required for each version.


##### Handle inconsistent API definitions

Kubernetes OpenAPI spec has a lot of typedefs under the `io.k8s.kubernetes.pkg`
namespace, which was where the types originally lived in v1.7 and are now just
kept for backwards-compatibility. The code generated by official handles them
badly. This crate [just ignores them](https://github.com/Arnavion/k8s-openapi-codegen/blob/15777b259ac16cc4287da3ede50f62d3c4508be9/src/fixups.rs#L339-L341).


### What this crate is NOT:

* This crate does not try to provide an idiomatic Rust API. API provided by
  this crate is rough and not very Rust-like due to auto-generated nature of the code.
  Fix-ups to the generated code (apart from what it does to work around mistakes in the spec, of course)
  are out of scope.
* It is not a goal to cover APIs of third-party kubernetes services like
  [openshift](https://github.com/Arnavion/k8s-openapi-codegen/issues/24#issuecomment-440990944)

This crate is exclusively focused on generating code from official Kubernetes API Specification


## Usage

### Generating the bindings

Run this binary:

```sh
  cargo run
```

Bindings will now be generated in the `k8s-openapi/` directory.


### Using the bindings

You can simply import the this crate into your project.

See `k8s-openapi/README.md` for information about the bindings crate itself.

See the `k8s-openapi-tests/` directory for examples.

